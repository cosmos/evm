# Cosmos EVM v0.5.0 â†’ v0.6.0 Migration

## 0) Prep

- Create a branch: `git switch -c upgrade/evm-v0.6`.
- Ensure a clean build + tests green pre-upgrade.
- Snapshot your current params/genesis for comparison later.

---

## 1) Dependency bumps (go.mod)

- Bump `github.com/cosmos/evm` to v0.6.0 and run:

```bash
go mod tidy
```

---

<!-- TODO: Other changes required for the upgrade -->

## 2) App wiring in `app.go`

### Default Precompiles

We added a new default precompile, ICS-02 Client Router. As such, the function signature for `DefaultStaticPrecompiles` has changed to accept a `clientKeeper` parameter.

```diff
	app.EVMKeeper = evmkeeper.NewKeeper(
		appCodec, keys[evmtypes.StoreKey], tkeys[evmtypes.TransientKey], keys,
		authtypes.NewModuleAddress(govtypes.ModuleName),
		app.AccountKeeper,
		app.PreciseBankKeeper,
		app.StakingKeeper,
		app.FeeMarketKeeper,
		&app.ConsensusParamsKeeper,
		&app.Erc20Keeper,
		evmChainID,
		tracer,
	).WithStaticPrecompiles(
		precompiletypes.DefaultStaticPrecompiles(
			*app.StakingKeeper,
			app.DistrKeeper,
			app.PreciseBankKeeper,
			&app.Erc20Keeper,
			&app.TransferKeeper,
			app.IBCKeeper.ChannelKeeper,
+			app.IBCKeeper.ClientKeeper,
			app.GovKeeper,
			app.SlashingKeeper,
			appCodec,
		),
	)
```

## 3) Remove werc20 precompile

The WERC20 precompile (or native precompile) has been removed together with the `erc20` module in this release.
If you've enabled it before, that address will become a normal address after upgrade, if you want to prevent user to
interact with it, you can deploy a revert contract to that address:

```solidity
// SPDX-License-Identifier: LGPL-3.0-only

pragma solidity >=0.8.0;

contract Revert {
    fallback() external {
        revert("WERC20 placeholder");
    }
}
```

BTW, the above contract compiles to the following runtime bytecode using solc 0.8.30:

```
0x6080604052348015600e575f5ffd5b506040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401603f90609e565b60405180910390fd5b5f82825260208201905092915050565b7f57455243323020706c616365686f6c64657200000000000000000000000000005f82015250565b5f608a6012836048565b91506093826058565b602082019050919050565b5f6020820190508181035f83015260b3816080565b905091905056fea26469706673582212204bb324dcc23d885a4e58390874b9c85aaca9245ce096c5aec8eefdfc2f12299a64736f6c634300081e0033
```
